<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private Real-Time Chat</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#e5ddd5;display:flex;justify-content:center;align-items:center;height:100vh;}
.login-container, .chat-container {width:100%;max-width:400px;height:600px;background:white;border-radius:10px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.login-container {justify-content:center;align-items:center;padding:20px;}
.login-container input {width:100%;padding:10px;margin:5px 0;border-radius:5px;border:1px solid #ccc;}
.login-container button {padding:10px 15px;border:none;background:#25D366;color:white;border-radius:20px;cursor:pointer;width:100%;margin-top:10px;}
.chat-header {background:#075E54;color:white;padding:10px;font-weight:bold;font-size:18px;text-align:center;}
.chat-messages {flex:1;overflow-y:auto;padding:10px;background:#ece5dd;display:flex;flex-direction:column;}
.message {margin:5px 0;padding:8px 12px;border-radius:20px;max-width:70%;word-wrap:break-word;position:relative;display:inline-block;}
.message.me {background:#dcf8c6;margin-left:auto;}
.message.them {background:white;margin-right:auto;}
.message .timestamp {font-size:10px;color:#666;position:absolute;bottom:-14px;right:10px;}
.chat-input {display:flex;padding:10px;background:#f0f0f0;gap:5px;flex-shrink:0;}
.chat-input input[type=text] {flex:1;padding:10px;border-radius:20px;border:1px solid #ccc;}
.chat-input button {padding:10px 15px;border:none;background:#25D366;color:white;border-radius:20px;cursor:pointer;}
.chat-input label {padding:10px 15px;background:#34B7F1;color:white;border-radius:20px;cursor:pointer;}
.file-preview {margin-top:5px;max-width:70%;border-radius:10px;}
img.file-preview, video.file-preview {max-width:100%;border-radius:10px;}
</style>
</head>
<body>

<div id="login" class="login-container">
<h2>Login</h2>
<form id="loginForm">
<input type="text" id="username" placeholder="Username" required>
<input type="password" id="password" placeholder="Password" required>
<button type="submit">Login</button>
</form>
<div id="loginError" style="color:red;margin-top:10px;"></div>
</div>

<div id="chat" class="chat-container" style="display:none;">
<div class="chat-header" id="chatHeader">Private Chat</div>
<div id="chatMessages" class="chat-messages"></div>
<div class="chat-input">
<input type="text" id="messageInput" placeholder="Type a message...">
<label for="fileInput">ðŸ“Ž Attach</label>
<input type="file" id="fileInput" style="display:none">
<button id="sendBtn">Send</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Users
const users = {
  'math_Star':'chatX436m',
  'javen':'TGFhbgj7'
};

let currentUser = '';
const roomId = 'privateRoom123';
const messagesRef = db.ref('rooms/' + roomId);

const loginDiv = document.getElementById('login');
const chatDiv = document.getElementById('chat');
const loginForm = document.getElementById('loginForm');
const loginError = document.getElementById('loginError');
const chatHeader = document.getElementById('chatHeader');
const chatMessages = document.getElementById('chatMessages');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const fileInput = document.getElementById('fileInput');

loginForm.addEventListener('submit', e => {
  e.preventDefault();
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if(users[user] && users[user] === pass){
    currentUser = user;
    loginDiv.style.display = 'none';
    chatDiv.style.display = 'flex';
    chatHeader.textContent = 'Chatting as: ' + currentUser;
    loadMessages();
  } else {
    loginError.textContent = 'Invalid username or password';
  }
});

function addMessageToChat(msgObj){
  const div = document.createElement('div');
  div.className = 'message ' + (msgObj.sender === currentUser ? 'me' : 'them');
  if(msgObj.type === 'text') div.textContent = msgObj.content;
  else if(msgObj.type === 'image') {
    const img = document.createElement('img');
    img.src = msgObj.content;
    img.className = 'file-preview';
    div.appendChild(img);
  } else if(msgObj.type === 'video') {
    const vid = document.createElement('video');
    vid.src = msgObj.content;
    vid.controls = true;
    vid.className = 'file-preview';
    div.appendChild(vid);
  }
  const ts = document.createElement('div');
  ts.className='timestamp';
  ts.textContent = new Date(msgObj.timestamp).toLocaleTimeString();
  div.appendChild(ts);
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function loadMessages(){
  chatMessages.innerHTML='';
  messagesRef.once('value', snapshot => {
    snapshot.forEach(child => addMessageToChat(child.val()));
  });
}

messagesRef.on('child_added', snapshot => {
  const data = snapshot.val();
  addMessageToChat(data);
});

sendBtn.onclick = () => {
  const text = messageInput.value.trim();
  const file = fileInput.files[0];
  const timestamp = Date.now();
  if(text){
    const msg = {sender:currentUser,type:'text',content:text,timestamp};
    messagesRef.push(msg);
    messageInput.value='';
  }
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      const ext = file.type.split('/')[0];
      const type = ext==='image'?'image':'video';
      const msg = {sender:currentUser,type,type,content:e.target.result,timestamp};
      messagesRef.push(msg);
    };
    reader.readAsDataURL(file);
    fileInput.value='';
  }
};

messageInput.addEventListener('keypress', e=>{if(e.key==='Enter') sendBtn.click();});
</script>

</body>
</html>
